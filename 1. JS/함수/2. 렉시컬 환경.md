## 1. 렉시컬 환경(Lexical Environment)

### 렉시컬 스코프(Lexical Scope)란?

렉시컬 환경을 이해하기 전에 먼저 **렉시컬 스코프(Lexical Scope)**를 알아야 합니다.

**렉시컬 스코프**: 함수가 **어디서 선언되었는지**에 따라 스코프가 결정되는 방식입니다. JavaScript는 렉시컬 스코프를 사용합니다.

동적 스코프와 달리, 렉시컬 스코프는 함수가 **호출된 위치**가 아니라 **선언된 위치**를 기준으로 스코프를 결정합니다.

```javascript
const x = "전역";

function outer() {
  const x = "외부";

  function inner() {
    console.log(x); // "외부" - 선언된 위치(outer 내부)의 스코프를 따름
  }

  return inner;
}

const innerFunc = outer();
innerFunc(); // "외부" (호출 위치와 무관하게 선언 위치의 스코프를 따름)
```

### 렉시컬 환경의 구조

**렉시컬 환경(Lexical Environment)**은 JavaScript 엔진이 변수와 함수를 관리하는 내부 메커니즘입니다. 다음과 같은 구조를 가집니다:

1. **환경 레코드(Environment Record)**: 변수와 함수 선언을 저장하는 곳

   - 선언적 환경 레코드(Declarative Environment Record): `let`, `const`, `function` 등
   - 객체 환경 레코드(Object Environment Record): `with` 문 등

2. **외부 렉시컬 환경 참조(Outer Lexical Environment Reference)**: 외부 스코프를 가리키는 참조
   - **스코프 체인**을 형성하여 변수 검색 경로를 만듭니다.

```javascript
function outer() {
  const a = 1; // outer의 렉시컬 환경에 저장

  function inner() {
    const b = 2; // inner의 렉시컬 환경에 저장
    console.log(a); // 외부 렉시컬 환경 참조를 통해 a에 접근
  }

  return inner;
}
```

### 렉시컬 환경의 동작 방식

이 코드에서:

- `outer` 함수가 실행되면 `outer`의 렉시컬 환경이 생성됩니다.
- `inner` 함수가 선언되면 `inner`의 렉시컬 환경이 생성되고, **외부 렉시컬 환경 참조**가 `outer`의 렉시컬 환경을 가리킵니다.
- `inner` 함수 내부에서 `a`를 참조할 때:
  1. 먼저 자신의 렉시컬 환경(환경 레코드)에서 찾습니다.
  2. 없으면 외부 렉시컬 환경 참조를 따라 `outer`의 렉시컬 환경에서 찾습니다.
  3. 계속 상위로 올라가며 찾습니다 **(스코프 체인)**

### 렉시컬 환경의 구조 예시

```javascript
// 전역 렉시컬 환경
// - 환경 레코드: { globalVar: "전역" }
// - 외부 렉시컬 환경 참조: null (최상위)
const globalVar = "전역";

function outer() {
  // outer의 렉시컬 환경
  // - 환경 레코드: { outerVar: "외부" }
  // - 외부 렉시컬 환경 참조: 전역 렉시컬 환경
  const outerVar = "외부";

  function inner() {
    // inner의 렉시컬 환경
    // - 환경 레코드: { innerVar: "내부" }
    // - 외부 렉시컬 환경 참조: outer의 렉시컬 환경
    const innerVar = "내부";

    console.log(innerVar); // 자신의 환경 레코드에서 찾음
    console.log(outerVar); // 외부 참조를 따라 outer의 환경 레코드에서 찾음
    console.log(globalVar); // 외부 참조를 따라 전역 환경 레코드에서 찾음
  }

  return inner;
}
```

### 실행 컨텍스트와 렉시컬 환경

함수가 실행될 때 **실행 컨텍스트(Execution Context)**가 생성되고, 각 실행 컨텍스트는 자신의 렉시컬 환경을 가집니다.

```javascript
function example() {
  const a = 1;
  const b = 2;

  function inner() {
    const c = 3;
    console.log(a, b, c);
  }

  inner();
}

example();
```

실행 순서:

1. 전역 실행 컨텍스트 생성 → 전역 렉시컬 환경 생성
2. `example` 실행 컨텍스트 생성 → `example` 렉시컬 환경 생성 (외부 참조: 전역)
3. `inner` 실행 컨텍스트 생성 → `inner` 렉시컬 환경 생성 (외부 참조: example)
4. `inner` 실행 완료 → `inner` 실행 컨텍스트 제거
5. `example` 실행 완료 → `example` 실행 컨텍스트 제거
